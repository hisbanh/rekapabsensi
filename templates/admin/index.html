{% extends 'admin/base.html' %}
{% load i18n static %}

{% block title %}{% if subtitle %}{{ subtitle }} | {% endif %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block branding %}
{% include "unfold/helpers/site_branding.html" %}
{% endblock %}

{% block extrahead %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static 'admin/css/dashboard.css' %}">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="flex flex-col lg:flex-row lg:gap-8">
    <div class="grow">
        <!-- Custom Dashboard -->
        <div class="dashboard-container">
            <!-- Header Section -->
            <div class="dashboard-header">
                <div class="header-content">
                    <h1 class="dashboard-title">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard SIPA YAUMI
                    </h1>
                    <p class="dashboard-subtitle">Sistem Informasi Presensi Pesantren Yaumi</p>
                    <div class="current-time">
                        <i class="fas fa-clock"></i>
                        <span id="current-time"></span>
                    </div>
                </div>
            </div>

            <!-- Statistics Cards -->
            <div class="stats-grid">
                <div class="stat-card primary">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">{{ total_students|default:0 }}</div>
                        <div class="stat-label">Total Siswa</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i> Siswa aktif
                        </div>
                    </div>
                </div>

                <div class="stat-card success">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">{{ present_today|default:0 }}</div>
                        <div class="stat-label">Hadir Hari Ini</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i> Kehadiran
                        </div>
                    </div>
                </div>

                <div class="stat-card warning">
                    <div class="stat-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">{{ absent_today|default:0 }}</div>
                        <div class="stat-label">Tidak Hadir</div>
                        <div class="stat-change neutral">
                            <i class="fas fa-minus"></i> Tidak hadir
                        </div>
                    </div>
                </div>

                <div class="stat-card info">
                    <div class="stat-icon">
                        <i class="fas fa-school"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">{{ class_stats|length|default:0 }}</div>
                        <div class="stat-label">Kelas Aktif</div>
                        <div class="stat-change neutral">
                            <i class="fas fa-minus"></i> SMP & SMA
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="dashboard-grid">
                <div class="dashboard-card chart-card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-bar"></i> Statistik Kehadiran Mingguan</h3>
                    </div>
                    <div class="card-content">
                        <canvas id="attendanceChart"></canvas>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <h3><i class="fas fa-bolt"></i> Aksi Cepat</h3>
                    </div>
                    <div class="card-content">
                        <div class="quick-actions">
                            <a href="{% url 'take_attendance' %}" class="quick-action primary">
                                <i class="fas fa-check-circle"></i>
                                <span>Ambil Absensi</span>
                            </a>
                            <a href="{% url 'admin:attendance_student_add' %}" class="quick-action success">
                                <i class="fas fa-user-plus"></i>
                                <span>Tambah Siswa</span>
                            </a>
                            <a href="{% url 'attendance_report' %}" class="quick-action info">
                                <i class="fas fa-chart-line"></i>
                                <span>Lihat Laporan</span>
                            </a>
                            <a href="{% url 'admin:attendance_classroom_add' %}" class="quick-action warning">
                                <i class="fas fa-plus-circle"></i>
                                <span>Tambah Kelas</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Unfold App List -->
        {% include "unfold/helpers/app_list_default.html" %}
    </div>

    {% include "unfold/helpers/history.html" %}
</div>

<script>
// Real-time clock
function updateTime() {
    const now = new Date();
    const options = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
    };
    const el = document.getElementById('current-time');
    if (el) el.textContent = now.toLocaleDateString('id-ID', options);
}
setInterval(updateTime, 1000);
updateTime();

// Attendance Chart
document.addEventListener('DOMContentLoaded', function() {
    const canvas = document.getElementById('attendanceChart');
    if (canvas) {
        const ctx = canvas.getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab', 'Min'],
                datasets: [{
                    label: 'Hadir (%)',
                    data: [95, 92, 98, 89, 94, 96, 88],
                    borderColor: '#28a745',
                    backgroundColor: 'rgba(40, 167, 69, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'top' } },
                scales: { y: { beginAtZero: true, max: 100 } }
            }
        });
    }
});
</script>
{% endblock %}