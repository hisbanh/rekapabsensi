{% extends 'manage/base_form.html' %}
{% load static %}

{% block page_title %}{% if is_edit %}Edit Hari Libur{% else %}Tambah Hari Libur{% endif %}{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{% url 'manage_holiday_list' %}">Hari Libur</a></li>
<li class="breadcrumb-item active">{% if is_edit %}Edit{% else %}Tambah{% endif %}</li>
{% endblock %}

{% block form_title %}{% if is_edit %}Edit Hari Libur{% else %}Tambah Hari Libur Baru{% endif %}{% endblock %}

{% block form_subtitle %}
{% if is_edit %}
Perbarui informasi hari libur {{ holiday.name }}
{% else %}
Isi form berikut untuk menambahkan hari libur baru
{% endif %}
{% endblock %}

{% block cancel_url %}{% url 'manage_holiday_list' %}{% endblock %}

{% block submit_text %}{% if is_edit %}Perbarui{% else %}Simpan{% endif %}{% endblock %}

{% block form_content %}
<!-- Basic Information Section -->
<div class="form-section">
    <h6 class="form-section-title">
        <i class="fas fa-calendar-times me-2"></i>Informasi Hari Libur
    </h6>
    <div class="form-row">
        <div class="mb-3">
            <label for="id_date" class="form-label">
                Tanggal <span class="text-danger">*</span>
            </label>
            {{ form.date }}
            {% if form.date.errors %}
            <div class="invalid-feedback d-block">{{ form.date.errors.0 }}</div>
            {% endif %}
        </div>
        <div class="mb-3">
            <label for="id_holiday_type" class="form-label">
                Tipe Libur <span class="text-danger">*</span>
            </label>
            {{ form.holiday_type }}
            {% if form.holiday_type.errors %}
            <div class="invalid-feedback d-block">{{ form.holiday_type.errors.0 }}</div>
            {% endif %}
        </div>
    </div>
    <div class="form-row single">
        <div class="mb-3">
            <label for="id_name" class="form-label">
                Nama Hari Libur <span class="text-danger">*</span>
            </label>
            {{ form.name }}
            {% if form.name.errors %}
            <div class="invalid-feedback d-block">{{ form.name.errors.0 }}</div>
            {% endif %}
        </div>
    </div>
    <div class="form-row single">
        <div class="mb-3">
            <label for="id_description" class="form-label">Keterangan</label>
            {{ form.description }}
            {% if form.description.errors %}
            <div class="invalid-feedback d-block">{{ form.description.errors.0 }}</div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Scope Section -->
<div class="form-section">
    <h6 class="form-section-title">
        <i class="fas fa-users me-2"></i>Berlaku Untuk
    </h6>
    <div class="mb-3">
        <div class="apply-scope-options">
            {% for radio in form.apply_scope %}
            <div class="form-check">
                {{ radio.tag }}
                <label class="form-check-label" for="{{ radio.id_for_label }}">
                    {% if radio.choice_value == 'all' %}
                    <strong>Semua Kelas</strong>
                    <div class="text-muted small">Hari libur berlaku untuk semua kelas</div>
                    {% else %}
                    <strong>Pilih Kelas Tertentu</strong>
                    <div class="text-muted small">Hari libur hanya berlaku untuk kelas yang dipilih</div>
                    {% endif %}
                </label>
            </div>
            {% endfor %}
        </div>
        {% if form.apply_scope.errors %}
        <div class="invalid-feedback d-block">{{ form.apply_scope.errors.0 }}</div>
        {% endif %}
    </div>
    
    <div class="mb-3" id="classroomsSection" style="display: none;">
        <label for="id_classrooms" class="form-label">
            Pilih Kelas <span class="text-danger">*</span>
        </label>
        {{ form.classrooms }}
        {% if form.classrooms.errors %}
        <div class="invalid-feedback d-block">{{ form.classrooms.errors.0 }}</div>
        {% endif %}
        <div class="form-text">Tahan Ctrl/Cmd untuk memilih beberapa kelas</div>
    </div>
</div>
{% endblock %}

{% block form_extra_css %}
<style>
    .apply-scope-options .form-check {
        padding: 1rem;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        margin-bottom: 0.5rem;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .apply-scope-options .form-check:hover {
        border-color: var(--primary);
        background-color: var(--bg-light);
    }
    
    .apply-scope-options .form-check-input:checked ~ .form-check-label {
        color: var(--primary);
    }
    
    .apply-scope-options .form-check:has(.form-check-input:checked) {
        border-color: var(--primary);
        background-color: rgba(139, 115, 85, 0.05);
    }
    
    #id_classrooms {
        min-height: 150px;
    }
</style>
{% endblock %}

{% block form_extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const applyScopeRadios = document.querySelectorAll('input[name="apply_scope"]');
    const classroomsSection = document.getElementById('classroomsSection');
    
    function toggleClassroomsSection() {
        const selectedValue = document.querySelector('input[name="apply_scope"]:checked')?.value;
        classroomsSection.style.display = selectedValue === 'specific' ? 'block' : 'none';
    }
    
    applyScopeRadios.forEach(radio => {
        radio.addEventListener('change', toggleClassroomsSection);
    });
    
    // Initial state
    toggleClassroomsSection();
});
</script>
{% endblock %}
